# Research Result: Template and Artifact Design

**Research area:** Area 6 from `02-research-planner.md`
**Status:** Complete

---

## Core Finding

The artifact and template systems are kept intact from GSD. No templates are cut, no new artifact types are created, and the `.blueprint/` directory structure mirrors `.planning/`. The key improvement is a **post-write verification gate**: after any workflow writes artifacts from user input (CONTEXT.md, PROJECT.md, REQUIREMENTS.md, ROADMAP.md, research docs), the orchestrator reads back what it wrote, summarizes to the user, and incorporates corrections before proceeding. This directly fixes the early-answer distortion problem without changing the write pipeline itself. STATE.md gets a compaction mechanism at milestone/project completion boundaries.

---

## Decision 1: Same Artifacts, No New Types

**Decision:** Enhanced interaction (Item 1) does not change what artifacts are produced. The same set of files is generated through the same agents and workflows. The improvement is in how the user validates what was written, not in what gets written.

**User's reasoning:** "I think it doesn't change the artifacts that get produced, but there needs to be some sort of improvement." The problem isn't the artifact design — it's that early answers in a questioning round get distorted by the time the artifact is written. The solution is verification, not restructuring.

**Complete artifact inventory (unchanged from GSD, renamed to .blueprint/):**

### Project-Level (always loaded)
| Artifact | Template | Created By | Consumed By |
|----------|----------|------------|-------------|
| PROJECT.md | `project.md` (184 lines) | `new-project` (synthesizer) | progress, plan-phase, execute-phase, verify-work |
| REQUIREMENTS.md | `requirements.md` (231 lines) | `new-project` | plan-phase, verify-work, research-phase |
| ROADMAP.md | `roadmap.md` (202 lines) | `new-project` (roadmapper agent) | progress, plan-phase, execute-phase, add/insert/remove-phase, complete-milestone |
| STATE.md | `state.md` (176 lines) | `new-project` (roadmapper agent) | **Every workflow** (first file read) |
| config.json | `config.json` (35 lines) | `new-project` / `settings` | All workflows (model resolution, gates, toggles) |

### Phase-Level (loaded per phase)
| Artifact | Template | Created By | Consumed By |
|----------|----------|------------|-------------|
| CONTEXT.md | `context.md` (283 lines) | `discuss-phase` | research-phase, plan-phase, executors |
| *-PLAN.md | (generated by planner, no template) | `plan-phase` (planner agent) | execute-phase, progress, wave grouping |
| *-SUMMARY.md | `summary.md` (246 lines) | `execute-phase` (executor agent) | progress, plan-phase (next phase), verify-work |
| *-RESEARCH.md | `research.md` (552 lines) | `research-phase` | plan-phase |

### Codebase Analysis (loaded when planning)
| Artifact | Template | Created By | Consumed By |
|----------|----------|------------|-------------|
| STACK.md | `codebase/stack.md` (186 lines) | `map-codebase` (tech mapper) | plan-phase, research-phase, executors |
| ARCHITECTURE.md | `codebase/architecture.md` (255 lines) | `map-codebase` (arch mapper) | plan-phase, research-phase, executors |
| CONVENTIONS.md | `codebase/conventions.md` (307 lines) | `map-codebase` (quality mapper) | execute-phase, verify-work |
| TESTING.md | `codebase/testing.md` (480 lines) | `map-codebase` (quality mapper) | execute-phase, verify-work |
| CONCERNS.md | `codebase/concerns.md` (310 lines) | `map-codebase` (concerns mapper) | plan-phase, execute-phase, verify-work |
| STRUCTURE.md | `codebase/structure.md` (285 lines) | `map-codebase` (arch mapper) | execute-phase, plan-phase |
| INTEGRATIONS.md | `codebase/integrations.md` (280 lines) | `map-codebase` (tech mapper) | plan-phase, execute-phase |

### Research (greenfield projects)
| Artifact | Template | Created By | Consumed By |
|----------|----------|------------|-------------|
| research/STACK.md | `research-project/STACK.md` (120 lines) | `new-project` (project-researcher) | plan-phase, execute-phase |
| research/ARCHITECTURE.md | `research-project/ARCHITECTURE.md` (204 lines) | `new-project` (project-researcher) | plan-phase, execute-phase |
| research/FEATURES.md | `research-project/FEATURES.md` (147 lines) | `new-project` (project-researcher) | plan-phase |
| research/PITFALLS.md | `research-project/PITFALLS.md` (200 lines) | `new-project` (project-researcher) | plan-phase, execute-phase |
| research/SUMMARY.md | `research-project/SUMMARY.md` (170 lines) | `new-project` (research-synthesizer) | plan-phase |

### Supporting
| Artifact | Template | Created By | Consumed By |
|----------|----------|------------|-------------|
| MILESTONES.md | `milestone.md` (115 lines) | `complete-milestone` | `new-milestone`, `audit-milestone` |
| milestone archives | `milestone-archive.md` (123 lines) | `complete-milestone` | reference only |
| DISCOVERY.md | `discovery.md` (146 lines) | `new-project` (greenfield) | `new-project` questioning |
| continue-here files | `continue-here.md` (78 lines) | `pause-work` | `resume-work` |
| USER-SETUP.md | `user-setup.md` (311 lines) | executors (when external setup needed) | user reference |
| DEBUG session files | `DEBUG.md` (159 lines) | `debug` | debug agents |
| UAT.md | `UAT.md` (247 lines) | `verify-work` | user acceptance |
| verification reports | `verification-report.md` (322 lines) | `verify-work` (verifier agent) | orchestrator |

**Total: 35 templates, all kept. 0 cut.**

---

## Decision 2: Post-Write Verification Gate (The Answer Distortion Fix)

**Decision:** Instead of changing the artifact writing pipeline (incremental writes, subagents, etc.), add a single manual verification step after each artifact write. The workflow stays the same — batch questions, then write. But after writing, the orchestrator reads back what it wrote and summarizes it to the user for feedback before proceeding.

**User's reasoning:** "I think the solution might be to just add a single manual verification step after without changing any other parts of the workflow. So just same exact workflow as exists, but add a final step where once the answers are submitted & written to proper artifacts the manual verification step triggers where orchestrator reads back what its written and summarizes everything to me for feedback."

**Why this works:** The distortion problem occurs because the agent writes an artifact from accumulated context where early answers have decayed. The fix isn't to change when writes happen — it's to catch and correct distortion immediately after. The verification summary surfaces misinterpretations while the user's actual intent is still fresh in their mind.

**Where verification gates apply:**

| Workflow | Artifact Written | Verification Gate |
|----------|-----------------|-------------------|
| `discuss-phase` | CONTEXT.md | After writing CONTEXT.md, summarize decisions per area, user confirms/corrects |
| `new-project` | PROJECT.md | After writing PROJECT.md, summarize core product description + constraints, user confirms/corrects |
| `new-project` | REQUIREMENTS.md | After writing REQUIREMENTS.md, summarize v1/v2/out-of-scope breakdown, user confirms/corrects |
| `new-project` | ROADMAP.md | After roadmapper writes ROADMAP.md, summarize phase structure + ordering, user confirms/corrects |
| `research-phase` | *-RESEARCH.md | After research agents complete, summarize key findings per topic, user validates (already established in Item 1 as post-research walkthrough) |

**Implementation pattern:**

```
[Existing workflow: collect answers, write artifact]
        |
        v
NEW STEP: Read back the artifact just written
        |
        v
NEW STEP: Summarize to user ("Here's what I captured: ...")
        |
        v
NEW STEP: User confirms or provides corrections
        |
        v
IF corrections: Apply corrections to artifact, re-summarize
IF confirmed: Proceed to next workflow step
```

**What this means for existing workflows:** Each workflow that writes artifacts from user input gains a 3-step tail: read-back, summarize, confirm/correct. The existing questioning logic, artifact templates, and write patterns are unchanged. The verification gate is additive.

**Relationship to Item 1 gates:** This is the concrete implementation of the "post-creation verification" gates described in Item 1. The Item 1 design said "summarization + verification" after requirements and roadmap creation. This decision extends that pattern to ALL artifact writes from user input (including CONTEXT.md from discuss-phase) and defines the mechanism: orchestrator reads back and summarizes, rather than spawning a verification subagent.

---

## Decision 3: No Template Simplification

**Decision:** All 35 templates survive the transition. None are cut. Some may be added.

**User's reasoning:** "I don't think templates need simplification. If they all get used, we're not cutting down on command surface or agent surface or workflow surface at all. In fact, we're probably just going to end up maybe adding a couple of things."

**What stays the same:**
- 7 core project templates
- 7 codebase analysis templates
- 5 research-project templates
- 4 summary variants (canonical + 3 instantiation levels: minimal, standard, complex)
- All supporting templates (milestone, debug, verification, UAT, continue-here, user-setup, phase-prompt, planner/debug subagent prompts)

**Potential additions (to be determined during implementation):**
- Template for STATE.md compaction output (if the compaction step needs a structured format)
- Template for pre-research interview notes (if the pre-research interview from Item 1 needs to persist its output)

These are small additions, not architectural changes. They'll be identified and created during the implementation phase as needed.

---

## Decision 4: STATE.md Compaction After Milestones

**Decision:** After milestone completion (and project completion), STATE.md gets aggressively compacted to just: current position + 3-5 key learnings about the development process + active blockers. Old performance metrics and accumulated decisions are discarded — they already exist in SUMMARY.md files and PROJECT.md.

**User's reasoning:** "It would make sense to have some sort of step after a complete milestone or a complete project, at the very least, where it takes what's in state and what was done and compacts it really aggressively down to maybe there's a couple of core things that were uncovered about the development process. It doesn't need to remember every single thing that happened."

**What gets discarded during compaction:**
- Performance Metrics table (per-plan execution rows) — detail lives in individual SUMMARY.md files
- Accumulated Decisions list (beyond the distilled learnings) — full decisions live in PROJECT.md and phase CONTEXT.md files
- Resolved blockers — no longer relevant
- Session Continuity section — reset for the new milestone

**What survives compaction:**
- **Current Position** — updated to reflect the new milestone's starting state
- **Key Learnings** (new section, replaces Accumulated Context) — 3-5 distilled insights about the development process that are genuinely useful for future work (e.g., "integration tests caught more bugs than unit tests for this codebase", "the auth module is fragile and needs careful testing when modified")
- **Active Blockers** — any unresolved blockers that carry forward

**Where discarded data goes:** Nowhere. It's discarded. The information is redundant — it already exists in the SUMMARY.md files, PROJECT.md decisions log, and phase CONTEXT.md documents. STATE.md is working memory, not an archive.

**Trigger points:**
- `complete-milestone` workflow — compact STATE.md as part of the completion sequence (after archival, before the milestone is officially closed)
- `complete-project` (if it exists) — same compaction

**Relationship to Item 5 (auto-remap at milestone completion):** The compaction step would happen alongside the auto-remap step in `complete-milestone`. The sequence is: finish milestone work → archive → compact STATE.md → remap codebase → close milestone.

---

## Decision 5: Keep the 100-Line Guideline

**Decision:** The 100-line guidance stays in the STATE.md template. The compaction mechanism is what enforces it.

**Why it exists:** STATE.md is loaded into every agent's context window as the first file read. A large STATE.md wastes context budget across every agent spawn in the system. The 100-line limit is a practical constraint, not arbitrary.

**How compaction enforces it:** Between compactions, STATE.md can grow beyond 100 lines (it accumulates metrics, decisions, blockers). That's fine — it's working memory during active development. At milestone boundaries, compaction resets it to well under 100 lines. The guideline serves as a target, not a hard limit.

---

## Decision 6: PROGRESS.md Is Not an Artifact

**Decision:** PROGRESS.md does not exist as a template or artifact. `/gsd:progress` (renamed to `/bp:progress`) is a command that reads STATE.md + ROADMAP.md + summaries to show progress and route to the next action. There is no separate progress-tracking file.

**User's reasoning:** "I don't see a @progress.md file in the templates at all, so I think this is something we can ignore."

**What this means:** Progress tracking happens in two existing places:
1. ROADMAP.md (status column per phase — tracks what's done)
2. STATE.md (current position — tracks where you are)

No third location needed. The `/bp:progress` command synthesizes these into a display, but doesn't produce a persistent artifact.

---

## What Changes from GSD

1. **Post-write verification gates** added to workflows that write artifacts from user input (discuss-phase, new-project, research-phase). New workflow steps, not new artifacts.
2. **STATE.md compaction** added to `complete-milestone` (and `complete-project`). New workflow step that aggressively resets STATE.md.
3. **Key Learnings section** replaces Accumulated Context in STATE.md after compaction. A distilled 3-5 items instead of an ever-growing list.
4. **100-line guideline** preserved as a target enforced by compaction.
5. **config.json additions:** `codebase_mapping` block (from Item 3), `agent_models` block (from Item 5). Template needs updating.
6. **All templates renamed** from GSD paths (`.planning/`) to Blueprint paths (`.blueprint/`). Mechanical.

## What Stays the Same

- All 35 templates (content and structure)
- The complete artifact inventory (project-level, phase-level, codebase, research, supporting)
- The producer/consumer relationships between artifacts
- The layered context loading pattern (project → phase → codebase → research)
- STATE.md's role as the entry point for every workflow
- Performance Metrics table format (between compactions)
- Frontmatter-based machine readability in SUMMARY.md files
- Summary variants (minimal, standard, complex) for different phase types
- The 4 focus areas for codebase mapping (tech, arch, quality, concerns)
- Research document structure (STACK, ARCHITECTURE, FEATURES, PITFALLS, SUMMARY)

---

## Implications for Implementation Planning

### What's Mechanical (Can Be Batched)
- Rename all template path references from `.planning/` to `.blueprint/`
- Rename all template internal references (gsd-tools → blueprint-tools, GSD → Blueprint, etc.)
- Update config.json template with `codebase_mapping` and `agent_models` fields
- Copy all 35 templates to Blueprint structure with updated paths

### What Requires Design Work
- **Post-write verification gate implementation** in each affected workflow (discuss-phase, new-project, research-phase). Each workflow needs: a read-back step, a summarization format appropriate to the artifact type, a correction-application step. The summarization format will differ — CONTEXT.md summary looks different from ROADMAP.md summary.
- **STATE.md compaction logic** — What exactly constitutes a "key learning"? The compaction step needs heuristics or an agent prompt that can distill accumulated decisions and metrics into 3-5 actionable insights. This is a judgment task, not a mechanical one.
- **Compaction integration with complete-milestone** — Sequencing the compaction step alongside auto-remap (from Item 5) and archival in the completion workflow.

### What's Its Own Phase
- The post-write verification gates could be implemented as a single phase across all affected workflows, since the pattern is consistent (read-back → summarize → confirm/correct) even if the summarization format varies per artifact type.

---

## Open Questions (For Other Research Areas)

- When does the `.planning/` → `.blueprint/` rename happen in the migration sequence? Does it happen all at once or can GSD and Blueprint coexist? (Area 7: Migration and Coexistence)
- Should the Blueprint npm package ship the templates directly, or does the installer generate them? (Area 7: Migration and Coexistence)
